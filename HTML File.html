<!DOCTYPE html>
<html lang="en">
<head>
     <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    -->

    <!-- Test Remote -->
    <!-- Test Local -->

    <meta charset="UTF-8">
    <title>Count Your Days</title>
    <style>
        header {
            background-color: #ad89cc;
            color: #352047;
            padding: 30px;
            text-align: center;
            font-size: 35px;
            margin-bottom: 20px;
        }
        footer {
            background-color: #ad89cc;
            color: #352047;
            margin-top: 20px;
            padding: 10px;
            text-align: center;
        }

        .big-container{
            align-items:center;
            align-self: center;
            background-color:#e7d7f4;
            border-radius: 50px;
            box-shadow: 10px 5px 5px #ad89cc;
            color:#572782;
            /*display: grid;*/
            font-family:Georgia, serif;
            font-size: 35px;
            justify-content: center;
            /*margin-top: 20px;
            margin-bottom: 20px;
            */
            margin: 20px auto;
            padding-top: 4px;
            padding-bottom: 4px;

            width: 75%;

        }


        .mini-container{
            width: 80%;
            height: 80%;
            background-color:#ad89cc;
            color:#352047;
            align-items:center;
            justify-content:center;
            font-size:20px;
            border-radius:50px;
            margin:10px;
            margin-left: auto;
            margin-right:auto;
            overflow: start;
            padding: 1% 0;
            

        }

        .fall{
            background-color:#dd8028;
            color:#643204;
        }

        .winter{
            background-color:#d9f9e4;
            color:#3f6069;
        }

        .spring{
            background-color:#8ed48e;
            color:#255325;
        }

        .merica{
            background: rgb(177,36,36);
            background: linear-gradient(90deg, rgba(177,36,36,1) 0%, rgba(255,255,255,1) 50%, rgba(29,29,143,1) 100%);        
        }
        .bluemilestone{
            background: rgb(31,149,230);
            background: radial-gradient(circle, rgba(31,149,230,1) 0%, rgba(14,43,129,1) 100%);
            color: #04436d;
        }
        .bronzemilestone{
            background: rgb(230,124,31);
            background: radial-gradient(circle, rgba(230,124,31,1) 0%, rgba(129,56,14,1) 100%);
            color: #784e00;
        }
        .silvermilestone{
            background: rgb(229,236,240);
            background: radial-gradient(circle, rgba(229,236,240,1) 0%, rgba(112,117,128,1) 100%);
            color: #787f82;
        }
        
        .goldmilestone{
            background: rgb(255,180,39);
            background: radial-gradient(circle, rgba(255,180,39,1) 0%, rgba(252,165,3,1) 35%, rgba(173,99,0,1) 100%);
            color: #784e00;
        }

        .nocti{
            background: #ff0000;
            background: radial-gradient(circle, rgba(255, 0, 0, 1) 0%, rgba(150, 0, 0, 1) 100%);
            color: #250046;
            font: italic bold 1.2rem "Fira Sans", serif;
        }

        body, html{
            height: 100%;
            justify-items:center;
        }

        .big {
            margin: 6%;
            margin-bottom:0;
            font-size: 40px;
        }
        .smol{
            margin:6%;
            margin-top: 1%;
            font-size:25px;
            margin-bottom: 0;
        }

        .mini-container ul {
            list-style: none;
            font-size: 30px;
            padding-left: 0;
       }

        @media all and (max-width: 480px) {
            .mini-container p:not(#daysLeft) {
            margin: 6%;
            font-size: 20px;
            
            }
        }

        #centerDiv{
            text-align: center;
        }

        .hidden{
            display: none;
        }

        button{
            cursor: pointer;
            background-color:#e7d7f4;
            border-radius: 10px;
            color:#572782;
            font-family: georgia, serif;
            /*border-style: hidden;*/
            border-color: #e7d7f4;     
        
        }

       
    </style>
</head>
<body>
    
    
    <header> <h1> Days until Summer Break! </h1></header>
    <div id="centerDiv">

        <div id="fileUpload" class="hidden">
            <input type="file" id="calendarFile"/><button id="processFile">Load</button>
        </div>
        <!--I don't remember how to open this-->
    
     <!--Leave us alone, it'll go away later (maybe)-->
        <!--So...about the center tag...( ;._.)-->

        <div class="big-container" title="School Days Left">
            <p  style="font-size:100px" id="weekdaysLeft"></p>
        </div>
        <div class="mini-container" title="Full Days Left" style="width:25%; box-shadow: 10px 5px 5px #6e4592;
        ">
            <p class="big" style="margin:6%" id="daysLeft"></p>
        </div>

        <br>
        <div>
            <button id="showDaysOff" >Show days off</button>
            <button id="showMilestones">Show milestones</button>

        </div>
    <div id="important-dates" class="big-container"></div>
    <div id="important-milestones" class="big-container hidden">Help.</div>

        <!--Can't get them to stack >:(    -->
    <!--Stretchy---->
 
    </div>
    <div>
    <div id="yippee"style="background-color:#ffffff ;cursor: default; height:100px; width:100px; display: inline-block">
        <img style="width:80%"src="https://f2.toyhou.se/file/f2-toyhou-se/thumbnails/74413749_DQt.gif" />
        <div id="wordYippee" class="hidden" style="font-family: cursive">Yipee</div>
    </div>
    <div id="sus"style="background-color:#ffffff ;cursor: default; height:100px; width:100px; float: right; display: inline-block">
      <img style="width:80%"src="https://f2.toyhou.se/file/f2-toyhou-se/images/74412876_A8N74a27mPBnDYz.png" />
      <div id="wordSus" class="hidden" style="font-family: cursive">Sus</div>
    </div>
    </div>

</body>    
<footer> Made by Zeph Burek and Arlo Russell </footer>




    <script >
        let startDate, endDate;
        let dateData;
        const importantDatesDiv = document.getElementById("important-dates");
        const importantMilestonesDiv = document.getElementById("important-milestones");
        const importantTimesDiv = document.getElementById("important-times"); //For Zeph's class times cuase idk how I would do that :)
        const explodesDiv = document.getElementById("wordYippee");
        const ejectedDiv = document.getElementById("wordSus");


        document.getElementById("showDaysOff").addEventListener("click", function(){
            importantMilestonesDiv.classList.add("hidden");
            importantDatesDiv.classList.remove("hidden");
        });
        document.getElementById("showMilestones").addEventListener("click", function(){
            importantMilestonesDiv.classList.remove("hidden");
            importantDatesDiv.classList.add("hidden");
        });

        document.getElementById("yippee").addEventListener("click", function(){
            explodesDiv.classList.remove("hidden");
            ejectedDiv.classList.add("hidden")
        });
        document.getElementById("sus").addEventListener("click", function(){
            ejectedDiv.classList.remove("hidden");
            explodesDiv.classList.add("hidden")
        });


        //Pulls dates from a cq
        fetch("https://ects-cmp.com/files/calendar.json")
        .then(resp => resp.json())
        .then(data => {
                processDateFile(data);               
        })
        //Write start date and end date when you can think again
        
        function processDateFile(data){
            printThings(data);
            dateData = data;

            
            //get the current date (it will be a date object)
            var today = new Date();
            var dd = String(today.getDate());
            var mm = String(today.getMonth() + 1);
            var yyyy = today.getFullYear();
            var todaystr = mm + '/' + dd + '/' + yyyy;
           // document.getElementById("today").innerHTML = today;                      
            //print out how many days from now until then
            endDate = data.endday;
            startDate = data.startday;

            //convert the enddate to a date object  
            //subtract all days listed as events after today from the weekdaysLeft 
            var weekdaysCount = getWeekdayCount();
          //  document.getElementById("weekdaysCount").innerHTML = weekdaysCount;
            var daysOffCount = getDaysOffLeft();


            var weekdaysLeft = weekdaysCount - daysOffCount;
            document.getElementById("weekdaysLeft").innerHTML = weekdaysLeft;
           // document.getElementById("enddate").innerHTML = endDate; //haha...
            
            var daysLeft = getDaysLeft();
            document.getElementById("daysLeft").innerHTML = daysLeft
            checkParams();

            dates(data.events, importantDatesDiv); /*KLINS - THIS NEEDS REPEATED FOR MILESTONES  (use data.milestones) - the method may need tweaked */ 
            dates(data.milestones, importantMilestonesDiv); //<-- Breaks it currently
        }
        

        function getDaysLeft(currentDate = new Date(), endDateObj = new Date(endDate)) {
            let count = 0;
           // const currentDate = new Date();
           // const endDateObj = new Date(endDate);
            console.log(currentDate);
            console.log(endDate);
            while (currentDate <= endDateObj) {
                
                const dayOfWeek = currentDate.getDay();
                        count++;
                currentDate.setDate(currentDate.getDate() + 1);
            }   
            return count;
        }

        function getWeekdayCount(currentDate = new Date(), endDateObj = new Date(endDate)) {
            let count = 0;
            console.log(currentDate);
            console.log(endDate);
            while (currentDate <= endDateObj) {
                
                const dayOfWeek = currentDate.getDay();
                    if (dayOfWeek !== 0 && dayOfWeek !== 6) {
                        count++;
                    }
                currentDate.setDate(currentDate.getDate() + 1);
            }   
            return count;
        }

            //https://i.pinimg.com/originals/6e/57/be/6e57be0a1421720a0fbcd618727b9e3e.gif <-- Yippee
            //https://i.gifer.com/embedded/download/YGg4.gif <-- Last day background

            function getDaysOffLeft(currentDate = new Date(), endDateObj = new Date(endDate)){
            let count = 0; //counts the number o' days off 

            for(let i = 0; i<dateData.events.length; i++){ 
                let foundFutureDates =false; 
                for(let j = 0; j<dateData.events[i].days.length; j++){
                    let dayOffDate = new Date(dateData.events[i].days[j])
                    if( dayOffDate> currentDate  && dayOffDate < endDateObj){
                        if(dayOffDate <= endDateObj){
                            count ++;
                        }
                    }
                }
            }

            return count;
        }

        function dates(){
            importantDatesDiv.innerHTML = "";
            const currentDate = new Date();
            for(let i = 0; i<dateData.events.length; i++){ 
                let foundFutureDates =false;
                let eventName = dateData.events[i].event;
                let eventClass = getEventClass(eventName);
                let newDiv = `<div class="mini-container ${eventClass}">`;
                let allDaysUntil = getDaysLeft(new Date(), new Date(dateData.events[i].days[0]));
                let weekDaysUntil = getWeekdayCount(new Date(), new Date(dateData.events[i].days[0]));
                newDiv += `<p class="big">${eventName}</p><p class="smol">(${weekDaysUntil - getDaysOffLeft(currentDate, new Date(dateData.events[i].days[0]))} / ${allDaysUntil})</p><ul>`;

                    for(let j = 0; j<dateData.events[i].days.length; j++){
                    let dayOffDate = new Date(dateData.events[i].days[j])
                    if( dayOffDate> currentDate ){
                        foundFutureDates = true;
                        newDiv +=
                         `                    
                            <li class="eventitem">  ${dateData.events[i].days[j]} </li>
                        
                        `;
                    }
                }
                if(foundFutureDates){
                    newDiv += `</ul></div>`;
                    importantDatesDiv.innerHTML += newDiv;
                }
            }
        }

        function milestones (){
            importantMilestonesDiv.innerHTML = "";
            const currentDate = new Date();
            for(let i = 0; i<dateData.milestones.length; i++){ 
                let foundFutureDates =false;
                let eventName = dateData.milestones[i].event;
                let eventClass = getEventClass(eventName);
                let newDiv = `<div class="mini-container ${eventClass}">`;
                let allDaysUntil = getDaysLeft(new Date(), new Date(dateData.milestones[i].day[0]));
                let weekDaysUntil = getWeekdayCount(new Date(), new Date(dateData.milestones[i].day[0]));
                newDiv += `<p class="big">${eventName}</p><p class="smol">(${weekDaysUntil - getDaysOffLeft()} / ${allDaysUntil})</p><ul>`;

                    for(let j = 0; j<dateData.milestones[i].day.length; j++){
                    let dayOffDate = new Date(dateData.milestones[i].day[j])
                    if( dayOffDate> currentDate ){
                        foundFutureDates = true;
                        newDiv +=
                         `                    
                            <li class="eventitem">  ${dateData.milestones[i].day[j]} </li>
                        
                        `;
                    }
                }
                if(foundFutureDates){
                    newDiv += `</ul></div>`;
                    importantmilestonesDiv.innerHTML += newDiv;
                }
            }
        }


        //the issue was that we are now passing in only the event data, so we don't need eventData.event[i], we just need eventData[i]
        function dates(eventData,   targetDiv = importantDatesDiv){
            targetDiv.innerHTML = "";
            const currentDate = new Date();
            console.log(eventData);
            for(let i = 0; i<eventData.length; i++){ 
                let foundFutureDates =false;
                let eventName = eventData[i].event;
                let eventClass = getEventClass(eventName);
                let newDiv = `<div class="mini-container ${eventClass}">`;
                let allDaysUntil = getDaysLeft(new Date(), new Date(eventData[i].days[0]));
                let weekDaysUntil = getWeekdayCount(new Date(), new Date(eventData[i].days[0]));
                newDiv += `<p class="big">${eventName}</p><p class="smol">(${weekDaysUntil - getDaysOffLeft(currentDate, new Date(eventData[i].days[0]))} / ${allDaysUntil})</p><ul>`;

                    for(let j = 0; j<eventData[i].days.length; j++){
                    let dayOffDate = new Date(eventData[i].days[j])
                    if( dayOffDate> currentDate ){
                        foundFutureDates = true;
                        newDiv +=
                         `                    
                            <li class="eventitem">  ${eventData[i].days[j]} </li>
                        
                        `;
                    }
                }
                if(foundFutureDates){
                    newDiv += `</ul></div>`;
                    targetDiv.innerHTML += newDiv;
                }
            }
        }



        function getEventClass(eventName){
            switch(eventName.toUpperCase()){
                case "THANKSGIVING BREAK":
                    return "fall";
                case"WINTER BREAK":
                    return "winter";
                case "SPRING BREAK":
                    return "spring";
                case "PRESIDENTS' DAY":
                case "MEMORIAL DAY":
                    return "merica";
                case "END OF Q1":
                case "MIDDLE OF Q1":
                    return "bronzemilestone";                    
                case "END OF Q2":
                case "MIDDLE OF Q2":
                    return "bronzemilestone";
                case "END OF Q3":
                case "MIDDLE OF Q3":
                    return "silvermilestone";
                case "END OF Q4":
                case "MIDDLE OF Q4":
                    return "goldmilestone";    
                case "NOCTI WRITTEN PRE-TEST (JUNIORS)":
                case "NOCTI WRITTEN TEST (SENIORS)":
                case "NOCTI PERFORMANCE TEST (SENIORS)":
                    return "nocti";
            }
        }

        function printThings(data){
            console.log(data);
            for(let i = 0; i<data.events.length; i++){ 
                console.log(data.events[i].event); 
                    for(let j = 0; j<data.events[i].days.length; j++){
                        console.log(data.events[i].days[j]);
                    }
            }
            
   
            console.log(data.events[0]);//the whole first event object
            console.log(data.events[0].event);//the event description
            console.log(data.events[0].days);//the days associated with the event
            console.log(data.events[0].days[0]);//the first associated day of the event
        }

        function checkParams(){
            let params = new URLSearchParams(document.location.search);
            let showFile = params.get("showfileupload"); // is the string "Jonathan"
            if(showFile != undefined){
                document.getElementById("fileUpload").classList.remove("hidden");
            }
        }
    </script>
    
</html>
<!--Html Notes:-->
<!--Border-radius is the rounded corners.-->
<!--align-items: center puts them at the center top to bottom-->
<!--justify-content puts them in the center side to side-->
<!--Appearantly height doesn't apply when the boxes are centered-->

<!--Note Key-->
<!--Arlo-->
<!--(Zeph)-->

<!--I don't know what's going on with the width for the mini boxes, they're killing me inside and I hate them...but they're pretty.-->
<!--I put an align enter in the body css. I can't check it tho-->
<!--I have no idea how to center align everything and I'm very annoyed so you're now going to have drop shadows-->
<!--And now I shall order our CSS in alphabetical order.-->

<!-- (JavaScript will be the death of me) -->
<!-- (But I think I actually know what I'm doing!)-->
<!-- (I am also calm now, but maybe it's because I am distracted)-->
<!-- (I lied, no longer knowing what Im doing) -->

<!--I have no idea what magic you pulled to get the start date/end date to work lol-->
<!--Have no idea what to do rn. Might go work on TH-->

<!-- (I am going to marry chatGPT when I grow up)-->

<!--Stupid text boses not holding the infor I need them to.-->
<!--How did I write that so bad????? What????-->
<!--I have no idea what happened to the enddate. I might drag Klins to figure it out-->
<!--*Confused Screaming*-->
<!--OMG THE BORDERS WERE IN % IM GOING TO DIE AAAAAAHHHHHHHHh-->

<!--I'm about to build some absolute bs code just to see if it works-->
<!--Eh, it kinda worked. Now I've broken the site-->
<!--This is annoying-->
<!--(times for class am and pm)-->
<!--(colors go brrrrr)-->